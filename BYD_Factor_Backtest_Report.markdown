# 比亚迪因子回测分析报告

## 1. 引言

因子分析是量化投资的核心，通过构建预测因子评估资产回报潜力。本报告基于比亚迪（BYD，股票代码：002594.SZ）股票数据，针对五个量化因子（`Turnover_Volatility_20D`, `Alpha6`, `VPR`, `HLM`, `DVM`）进行回测，旨在：

- 评估因子对未来回报的预测能力（信息系数，IC）。
- 分析因子驱动策略的收益与风险（夏普比率、最大回撤等）。
- 确保因子间低相关性（最大相关系数 ≤ 0.5），支持多样化组合。

**数据来源**：
- **Tushare**：提供比亚迪日线数据（2022年4月30日至2025年4月30日），包括收盘价、成交量、成交额等。
- **CSMAR 数据库**：补充部分因子计算所需的高频交易数据和财务指标（如换手率）。

报告涵盖数据描述、因子定义、回测方法、绩效分析、相关性分析及综合讨论，为量化策略优化提供依据。

## 2. 数据与因子描述

### 2.1 数据集
- **原始数据**：通过 Tushare 获取比亚迪日线数据，保存为 `BYD.csv`，包含字段：
  - `Clsprc`：收盘价。
  - `Opnprc`：开盘价。
  - `Volume`：成交量。
  - `Amount`：成交额。
  - `ToverOs`：换手率。
- **因子数据**：基于 `BYD.csv` 计算因子，保存为 `BYD_factors.csv`，包含五个因子值。
- **时间范围**：2022年4月30日至2025年4月30日，约三年数据。
- **数据量**：清洗后 707 个交易日，支持年度化指标计算。

### 2.2 因子定义与数学表达式
以下为五个因子的定义及其数学表达式：

1. **Turnover_Volatility_20D**（20天换手率波动率）：
   - **定义**：衡量换手率在20天窗口的波动性，反映市场交易活跃度的变化。
   - **数学表达式**：
     \[
     \text{Turnover_Volatility}_{20D,t} = \sqrt{\frac{1}{20} \sum_{i=t-19}^{t} (\text{ToverOs}_i - \bar{\text{ToverOs}})^2}
     \]
     其中，\(\text{ToverOs}_i\) 为第 \(i\) 天的换手率，\(\bar{\text{ToverOs}}\) 为20天换手率均值。

2. **Alpha6**（开盘价与成交量负相关性）：
   - **定义**：计算10天窗口内开盘价与成交量的负相关系数，捕捉价格-成交量背离。
   - **数学表达式**：
     \[
     \text{Alpha6}_t = - \text{Corr}(\text{Opnprc}_{t-9:t}, \text{Volume}_{t-9:t})
     \]
     其中，\(\text{Corr}\) 为 Pearson 相关系数，\(\text{Opnprc}\) 和 \(\text{Volume}\) 分别为开盘价和成交量。

3. **VPR**（成交量-价格共振）：
   - **定义**：当5天成交量斜率和价格动量同为正时，赋值为1，否则为0，表示成交量与价格同步上涨。
   - **数学表达式**：
     \[
     \text{VPR}_t = 
     \begin{cases} 
     1, & \text{if } \text{Slope}(\text{Volume}_{t-4:t}) > 0 \text{ and } \text{Momentum}_{5D,t} > 0 \\
     0, & \text{otherwise}
     \end{cases}
     \]
     其中，\(\text{Slope}(\text{Volume})\) 为成交量线性回归斜率，\(\text{Momentum}_{5D,t} = \frac{\text{Clsprc}_t}{\text{Clsprc}_{t-5}} - 1\)。

4. **HLM**（异质流动性动量）：
   - **定义**：结合20天价格动量与上下行成交量比率，反映流动性驱动的动量效应。
   - **数学表达式**：
     \[
     \text{HLM}_t = \text{sign}(\text{Momentum}_{20D,t}) \cdot \frac{\text{Up_Volume_Mean}_{20D,t}}{\text{Down_Volume_Mean}_{20D,t}}
     \]
     其中，\(\text{Momentum}_{20D,t} = \frac{\text{Clsprc}_t}{\text{Clsprc}_{t-20}} - 1\)，\(\text{Up_Volume_Mean}_{20D,t}\) 和 \(\text{Down_Volume_Mean}_{20D,t}\) 分别为20天上涨和下跌成交量均值。

5. **DVM**（方向性成交量动量）：
   - **定义**：衡量20天窗口内价格方向与成交量变化方向的一致性比例。
   - **数学表达式**：
     \[
     \text{DVM}_t = \frac{1}{20} \sum_{i=t-19}^{t} \mathbb{1}(\text{Price_Direction}_i \cdot \text{Volume_Change_Dir}_i > 0)
     \]
     其中，\(\text{Price_Direction}_i = \text{sign}(\text{Clsprc}_i - \text{Clsprc}_{i-1})\)，\(\text{Volume_Change_Dir}_i = \text{sign}(\text{Volume}_i - \text{Volume}_{i-1})\)，\(\mathbb{1}\) 为指示函数。

### 2.3 数据预处理
- **每日回报**：计算 \(\text{Daily_Return}_t = \frac{\text{Clsprc}_t}{\text{Clsprc}_{t-1}} - 1\)。
- **缺失值处理**：
  - 因子列缺失值：`Turnover_Volatility_20D`（19个）、`HLM`（20个）、`DVM`（19个）、`Alpha6` 和 `VPR`（0个）。
  - `Daily_Return` 缺失值：1个（首行）。
  - 移除包含 NaN 的行，清洗后数据量为 707 个交易日。
- **数据来源补充**：CSMAR 数据库提供换手率（`ToverOs`）等高频数据，确保因子计算准确。

## 3. 回测方法

### 3.1 回测思路
回测采用单资产（BYD）因子驱动策略，步骤如下：
1. **因子信号生成**：
   - 对于每个因子，若 \(\text{Factor}_t > 0\)，生成多头信号（\(\text{Position}_t = 1\)）；否则不持有（\(\text{Position}_t = 0\)）。
   - 信号延迟一天（\(\text{Position.shift(1)}\)），模拟基于前一天因子值的交易决策。
2. **投资组合构建**：
   - 组合回报：\(\text{Portfolio_Return}_t = \text{Position}_{t-1} \cdot \text{Daily_Return}_t\)。
   - 假设全额投资，无交易成本。
3. **绩效指标计算**：
   - **IC**：\(\text{Corr}_{\text{Spearman}}(\text{Factor}_t, \text{Daily_Return}_{t+1})\)。
   - **夏普比率**：\(\frac{\text{mean}(\text{Portfolio_Return})}{\text{std}(\text{Portfolio_Return})} \cdot \sqrt{252}\)。
   - **收益风险比**：\(\frac{\text{mean}(\text{Portfolio_Return})}{\text{std}(\text{Portfolio_Return})}\)。
   - **最大回撤**：\(\max\left(\frac{\text{rolling_max}_t - \text{cumulative_return}_t}{\text{rolling_max}_t}\right)\)，其中 \(\text{cumulative_return}_t = \prod_{i=1}^t (1 + \text{Portfolio_Return}_i)\)。
   - **年化收益率**：\((1 + \text{mean}(\text{Portfolio_Return}))^{252} - 1\)。
   - **年化波动率**：\(\text{std}(\text{Portfolio_Return}) \cdot \sqrt{252}\)。
4. **相关性分析**：
   - 计算因子间 Pearson 相关系数矩阵。
   - 绘制热力图，检查最大相关系数是否 ≤ 0.5。

### 3.2 关键假设
- **单资产**：仅回测 BYD（002594.SZ）。
- **无交易成本**：忽略交易费用、滑点。
- **年度化**：一年 252 个交易日。
- **信号逻辑**：因子值正负驱动多头信号，未考虑做空。

## 4. 因子绩效分析

以下为五个因子的回测绩效（基于实际运行结果）：

| 因子                    | IC       | 夏普比率 | 收益风险比 | 最大回撤 | 年化收益率 | 年化波动率 |
|-------------------------|----------|----------|------------|----------|------------|------------|
| Turnover_Volatility_20D | -0.0178  | 0.3365   | 0.0212     | 0.5276   | 0.1233     | 0.3455     |
| Alpha6                  | 0.0299   | 0.1677   | 0.0106     | 0.4323   | 0.0391     | 0.2287     |
| VPR                     | 0.0291   | 0.7449   | 0.0469     | 0.2683   | 0.1437     | 0.1803     |
| HLM                     | -0.0200  | 0.2650   | 0.0167     | 0.3521   | 0.0673     | 0.2459     |
| DVM                     | -0.0152  | 0.3365   | 0.0212     | 0.5276   | 0.1233     | 0.3455     |

### 4.1 分析
- **IC**：`Alpha6`（0.0299）和 `VPR`（0.0291）显示微弱正向预测能力，表明其与下一交易日回报略相关。`Turnover_Volatility_20D`（-0.0178）、`HLM`（-0.0200）、`DVM`（-0.0152）预测能力较弱，IC 接近 0 或负值。
- **夏普比率**：`VPR`（0.7449）表现最佳，接近优秀策略水平（> 1），其他因子偏低（< 0.5），需优化。
- **最大回撤**：`VPR`（26.83%）风险最低，`Turnover_Volatility_20D` 和 `DVM`（52.76%）风险较高，需谨慎使用。
- **年化收益率**：`VPR`（14.37%）收益最高，`Alpha6`（3.91%）最低，整体收益中等。
- **年化波动率**：`VPR`（18.03%）波动最低，`Turnover_Volatility_20D` 和 `DVM`（34.55%）波动较高，策略稳定性较差。

## 5. 因子相关性分析

### 5.1 相关系数矩阵
因子间的 Pearson 相关系数矩阵如下（实际结果）：

|                         | Turnover_Volatility_20D | Alpha6 | VPR    | HLM    | DVM    |
|-------------------------|-------------------------|--------|--------|--------|--------|
| Turnover_Volatility_20D | 1.0000                  | -0.0668 | 0.0071 | 0.3343 | 0.0326 |
| Alpha6                  | -0.0668                 | 1.0000 | -0.1699 | -0.1015 | -0.1388 |
| VPR                     | 0.0071                  | -0.1699 | 1.0000 | 0.1802 | 0.1727 |
| HLM                     | 0.3343                  | -0.1015 | 0.1802 | 1.0000 | 0.2670 |
| DVM                     | 0.0326                  | -0.1388 | 0.1727 | 0.2670 | 1.0000 |

- **最大相关系数**：0.3343（`Turnover_Volatility_20D` 与 `HLM`），低于 0.5，满足低相关性要求。

### 5.2 热力图
相关系数矩阵通过热力图可视化（见图 1），红色表示正相关，蓝色表示负相关，白色表示低相关。热力图保存为 `factors_correlation_heatmap.png`.

**图 1：因子相关系数热力图**  
![因子相关系数热力图](factors_correlation_heatmap.png)

### 5.3 分析
- 因子间相关性较低，最大值为 0.3343，表明因子具有较好独立性。
- `Turnover_Volatility_20D` 与 `HLM`（0.3343）相关性较高，可能因两者均涉及成交量相关指标，但仍在可接受范围内。
- 低相关性支持多因子模型构建，减少冗余风险。

## 6. 综合评估与讨论

### 6.1 总体表现
- **平均夏普比率**：0.3701，表明因子整体表现中等，需进一步优化。
- **最佳因子**：`VPR` 在 IC（0.0291）、夏普比率（0.7449）、最大回撤（26.83%）和年化收益率（14.37%）上表现突出，适合优先考虑。
- **弱势因子**：`Alpha6`（夏普比率 0.1677）和 `HLM`（IC -0.0200）表现较差，可能需重新定义或剔除。

### 6.2 局限性
- **单资产**：仅回测 BYD，泛化能力待验证。
- **简单信号**：因子值 > 0 的二元信号可能未充分利用因子分布。
- **无交易成本**：忽略交易费用和滑点，高估实际绩效。
- **预测能力有限**：IC 绝对值较低（< 0.03），因子预测能力需增强。
- **数据依赖**：结果依赖 Tushare 和 CSMAR 数据质量，部分因子（如 `HLM`）有较多缺失值。

### 6.3 改进建议
1. **复杂信号**：使用因子 Z 分数生成信号：
   \[
   \text{Position}_t = \begin{cases} 
   1, & \text{if } \frac{\text{Factor}_t - \mu}{\sigma} > 0 \\
   0, & \text{otherwise}
   \end{cases}
   \]
2. **做空策略**：因子值 < 0 时做空（\(\text{Position}_t = -1\)）。
3. **多资产回测**：扩展到 A 股市场其他股票，排序选择顶部资产。
4. **交易成本**：加入 0.1% 交易费用模型。
5. **因子优化**：改进 `Alpha6` 和 `HLM`，或引入新因子（如基于 CSMAR 的财务因子）。
6. **数据完善**：减少缺失值，延长数据周期。

## 7. 结论

本次回测分析了比亚迪股票的五个量化因子，得出以下结论：
- `VPR` 表现出较强的预测能力和投资绩效（夏普比率 0.7449，年化收益率 14.37%），适合优先开发。
- 因子间最大相关系数为 0.3343，满足低相关性要求，支持多因子策略。
- 平均夏普比率为 0.3701，整体表现中等，需优化信号和扩展资产范围。

**后续建议**：
- 进行多资产回测，验证因子泛化能力。
- 引入交易成本和复杂信号，评估实际绩效。
- 基于 CSMAR 数据开发新因子，增强预测能力。

本报告为量化策略开发提供了数据支持，后续可进一步迭代优化。

---
**附录**：
- 数据文件：`BYD.csv`, `BYD_factors.csv`
- 输出文件：`factor_performance.csv`, `factors_correlation_heatmap.png`
- 分析代码：`MFE5210_Assignment.ipynb`